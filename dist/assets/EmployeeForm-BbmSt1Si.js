import{b as w,B as i,r as g,j as e}from"./index-CvOK6pca.js";import{j as C,v as F}from"./index-B8cdnCNl.js";import{g as P}from"./helpers-CaOlnEck.js";const I=async(x,u,o)=>{const t=new FormData;t.append("profileImage",x);try{console.log(`Uploading profile image for employee ID ${u}`);const d=await w.post(`/upload/profile-image/${u}`,t,{headers:{"Content-Type":"multipart/form-data"}});return i.success("Profile image uploaded successfully"),d.data}catch(d){throw console.error("Profile image upload error:",d),i.error(`Failed to upload profile image: ${d.message}`),d}},S=({onSubmit:x,loading:u,initialData:o={},isEditMode:t=!1,onSuccess:d})=>{const[s,p]=g.useState({username:"",password:"",firstName:"",lastName:"",email:"",phone:"",department:"",position:"",employmentType:"Full Time",salary:"",bankDetails:{bankName:"",accountHolderName:"",ifscCode:""},address:{street:"",city:"",state:"",zipCode:"",country:""}}),[b,h]=g.useState(null),[j,y]=g.useState(null),f=g.useRef(null);g.useEffect(()=>{o&&Object.keys(o).length>0&&(p(l=>({...l,...o,bankDetails:{...l.bankDetails,...o.bankDetails||{}},address:{...l.address,...o.address||{}}})),o.profileImage&&y(P(o.profileImage)))},[o]);const a=l=>{const{name:r,value:n}=l.target;if(r.startsWith("address.")){const m=r.split(".")[1];p(c=>({...c,address:{...c.address,[m]:n}}))}else if(r.startsWith("bankDetails.")){const m=r.split(".")[1];p(c=>({...c,bankDetails:{...c.bankDetails,[m]:n}}))}else p(m=>({...m,[r]:n}))},N=l=>{const r=l.target.files[0];if(!r)return;if(r.size>5*1024*1024){i.error("Image file is too large. Maximum size is 5MB.");return}if(!r.type.match("image.*")){i.error("Please select an image file.");return}h(r);const n=new FileReader;n.onload=()=>{y(n.result)},n.readAsDataURL(r)},v=()=>{p({username:"",password:"",firstName:"",lastName:"",email:"",phone:"",department:"",position:"",employmentType:"Full Time",salary:"",bankDetails:{bankName:"",accountHolderName:"",ifscCode:""},address:{street:"",city:"",state:"",zipCode:"",country:""}}),h(null),y(null),f.current&&(f.current.value="")},k=async l=>{l.preventDefault();try{i.info("Saving employee data...");const r=await x(s);console.log("Employee save response:",r);const n=(r==null?void 0:r._id)||(o==null?void 0:o._id);if(!n){i.error("Failed to get employee ID for file uploads");return}let m=!1;if(b)try{await I(b,n,"image")}catch(c){console.error("Profile image upload failed:",c),m=!0}m?i.warning("Employee saved but profile image failed to upload. Please try uploading again."):(i.success(`Employee ${t?"updated":"created"} successfully`),v(),typeof d=="function"&&d())}catch(r){console.error("Form submission error:",r),i.error(`Failed to ${t?"update":"create"} employee: ${r.message}`)}};return e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"w-32 h-32 overflow-hidden bg-gray-200 rounded-full",children:j?e.jsx("img",{src:j,alt:"Profile Preview",className:"object-cover w-full h-full"}):e.jsx("div",{className:"flex items-center justify-center w-full h-full text-gray-400",children:e.jsx(C,{size:40})})}),e.jsx("button",{type:"button",onClick:()=>{var l;return(l=f.current)==null?void 0:l.click()},className:"absolute bottom-0 right-0 p-2 text-white bg-indigo-600 rounded-full hover:bg-indigo-700",children:e.jsx(F,{})}),e.jsx("input",{type:"file",ref:f,onChange:N,accept:"image/*",className:"hidden"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload a passport size photo"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"block mb-1 font-medium text-gray-700",children:"Username*"}),e.jsx("input",{type:"text",id:"username",name:"username",value:s.username,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!t})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block mb-1 font-medium text-gray-700",children:"Password*"}),e.jsx("input",{type:"password",id:"password",name:"password",value:s.password,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!t})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"firstName",className:"block mb-1 font-medium text-gray-700",children:"First Name*"}),e.jsx("input",{type:"text",id:"firstName",name:"firstName",value:s.firstName,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"lastName",className:"block mb-1 font-medium text-gray-700",children:"Last Name*"}),e.jsx("input",{type:"text",id:"lastName",name:"lastName",value:s.lastName,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block mb-1 font-medium text-gray-700",children:"Email*"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block mb-1 font-medium text-gray-700",children:"Phone"}),e.jsx("input",{type:"text",id:"phone",name:"phone",value:s.phone,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"department",className:"block mb-1 font-medium text-gray-700",children:"Department"}),e.jsx("input",{type:"text",id:"department",name:"department",value:s.department,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"position",className:"block mb-1 font-medium text-gray-700",children:"Position"}),e.jsx("input",{type:"text",id:"position",name:"position",value:s.position,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employmentType",className:"block mb-1 font-medium text-gray-700",children:"Employment Type"}),e.jsxs("select",{id:"employmentType",name:"employmentType",value:s.employmentType,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",children:[e.jsx("option",{value:"Full Time",children:"Full Time"}),e.jsx("option",{value:"Part Time",children:"Part Time"}),e.jsx("option",{value:"Intern",children:"Intern"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"salary",className:"block mb-1 font-medium text-gray-700",children:"Salary"}),e.jsx("input",{type:"number",id:"salary",name:"salary",value:s.salary,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-lg font-medium",children:"Bank Details"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bankName",className:"block mb-1 font-medium text-gray-700",children:"Bank Name"}),e.jsx("input",{type:"text",id:"bankName",name:"bankDetails.bankName",value:s.bankDetails.bankName,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"accountHolderName",className:"block mb-1 font-medium text-gray-700",children:"Account Holder Name"}),e.jsx("input",{type:"text",id:"accountHolderName",name:"bankDetails.accountHolderName",value:s.bankDetails.accountHolderName,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"ifscCode",className:"block mb-1 font-medium text-gray-700",children:"IFSC Code"}),e.jsx("input",{type:"text",id:"ifscCode",name:"bankDetails.ifscCode",value:s.bankDetails.ifscCode,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 text-lg font-medium",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"street",className:"block mb-1 font-medium text-gray-700",children:"Street"}),e.jsx("input",{type:"text",id:"street",name:"address.street",value:s.address.street,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block mb-1 font-medium text-gray-700",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"address.city",value:s.address.city,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block mb-1 font-medium text-gray-700",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"address.state",value:s.address.state,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"zipCode",className:"block mb-1 font-medium text-gray-700",children:"Zip Code"}),e.jsx("input",{type:"text",id:"zipCode",name:"address.zipCode",value:s.address.zipCode,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block mb-1 font-medium text-gray-700",children:"Country"}),e.jsx("input",{type:"text",id:"country",name:"address.country",value:s.address.country,onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200"})]})]})]}),e.jsx("div",{className:"flex justify-end space-x-3",children:e.jsx("button",{type:"submit",disabled:u,className:`px-4 py-2 font-bold text-white rounded ${u?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:u?"Processing...":t?"Update Employee":"Create Employee"})})]})};export{S as E};
