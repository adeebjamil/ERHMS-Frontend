import{r as d,j as e,b as u,B as p}from"./index-CvOK6pca.js";import{Q as B,U as $,g as V,f as F,w as I,v as C}from"./index-B8cdnCNl.js";const q=()=>{const[x,c]=d.useState(!0),[o,g]=d.useState(null),[a,n]=d.useState(null);d.useRef(!1);const[i,v]=d.useState({fullNameAsPerDocuments:"",dateOfBirth:"",passportNumber:"",passportExpiryDate:"",visaNumber:"",visaExpiryDate:""}),[w,D]=d.useState(null),[E,P]=d.useState(null),[h,N]=d.useState(null),[b,j]=d.useState(null);d.useEffect(()=>{(async()=>{try{c(!0);const{data:l}=await u.get("/employees/travel-documents/status");if(l&&l.isSubmitted){n(!0);const{data:r}=await u.get("/employees/travel-documents");r&&(g(r),f(r))}else n(!1),S()}catch(l){console.error("Error checking document status:",l);try{const{data:r}=await u.get("/employees/travel-documents");r&&r.isSubmitted?(n(!0),g(r),f(r)):(n(!1),r&&(g(r),f(r)))}catch(r){console.error("Error with fallback document check:",r),n(!1)}}finally{c(!1)}})()},[]);const f=s=>{v({fullNameAsPerDocuments:s.fullNameAsPerDocuments||"",dateOfBirth:s.dateOfBirth?s.dateOfBirth.split("T")[0]:"",passportNumber:s.passportNumber||"",passportExpiryDate:s.passportExpiryDate?s.passportExpiryDate.split("T")[0]:"",visaNumber:s.visaNumber||"",visaExpiryDate:s.visaExpiryDate?s.visaExpiryDate.split("T")[0]:""}),s.passportImageUrl&&N(`${"https://ehrms-backend.onrender.com/api".replace("/api","")}${s.passportImageUrl}`),s.visaImageUrl&&j(`${"https://ehrms-backend.onrender.com/api".replace("/api","")}${s.visaImageUrl}`)},S=async()=>{try{c(!0);const{data:s}=await u.get("/employees/travel-documents");s&&(g(s),f(s))}catch(s){console.error("Error fetching travel documents:",s)}finally{c(!1)}},m=s=>{if(a)return;const{name:l,value:r}=s.target;v(t=>({...t,[l]:r}))},y=(s,l)=>{if(a)return;const r=s.target.files[0];if(r){if(r.size>5*1024*1024){p.error("File is too large. Maximum size is 5MB.");return}if(!r.type.match("image.*")&&!r.type.match("application/pdf")){p.error("Please select an image or PDF file.");return}if(r.type.match("image.*")){const t=new FileReader;t.onload=()=>{l==="passport"?(N(t.result),D(r)):(j(t.result),P(r))},t.readAsDataURL(r)}else l==="passport"?(D(r),N(null)):(P(r),j(null))}},O=async s=>{var l,r;if(s.preventDefault(),a||o&&o.isSubmitted){p.error("Documents have already been submitted and cannot be modified.");return}try{const{data:t}=await u.get("/employees/travel-documents/status");if(t&&t.isSubmitted){n(!0),p.error("Documents have already been submitted and cannot be modified.");return}}catch(t){console.error("Error verifying submission status:",t)}c(!0);try{const t=new FormData;Object.keys(i).forEach(k=>{t.append(k,i[k])}),t.append("isSubmitted",!0),w&&t.append("passportImage",w),E&&t.append("visaImage",E),await u.post("/employees/travel-documents",t,{headers:{"Content-Type":"multipart/form-data"}}),n(!0),p.success("Travel documents submitted successfully! Your documents are now locked for editing."),setTimeout(()=>{S()},1e3)}catch(t){console.error("Error submitting travel documents:",t),p.error(((r=(l=t.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to submit travel documents")}finally{c(!1)}};return x?e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"}),e.jsx("p",{className:"ml-2",children:"Loading your document status..."})]}):a===null?null:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"pb-5 border-b border-gray-200",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Travel Documents"}),e.jsx("p",{className:"mt-2 text-gray-600",children:a?e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(B,{className:"mr-2"})," Your travel documents have been submitted and cannot be modified."]}):"Please provide your passport and visa details as they appear on your documents."})]}),a?e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx($,{className:"text-blue-500 mr-2 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-700",children:"Your travel documents have been successfully submitted and are now locked."}),e.jsx("p",{className:"mt-2 text-blue-700",children:"If you need to make changes to your submitted documents, please contact HR."}),e.jsxs("a",{href:"mailto:hr@company.com",className:"mt-3 inline-flex items-center text-indigo-600 hover:text-indigo-800",children:[e.jsx(V,{className:"mr-1"})," Contact HR"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[e.jsx(F,{className:"mr-2 text-indigo-600"})," Passport Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Full Name (as per documents)"}),e.jsx("p",{className:"font-medium",children:i.fullNameAsPerDocuments})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Date of Birth"}),e.jsx("p",{className:"font-medium",children:i.dateOfBirth})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Passport Number"}),e.jsx("p",{className:"font-medium",children:i.passportNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Passport Expiry Date"}),e.jsx("p",{className:"font-medium",children:i.passportExpiryDate})]}),h&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Passport Image"}),e.jsx("img",{src:h,alt:"Passport",className:"w-full max-w-md h-auto rounded-md border border-gray-300"})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[e.jsx(I,{className:"mr-2 text-indigo-600"})," Visa Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Visa Number"}),e.jsx("p",{className:"font-medium",children:i.visaNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Visa Expiry Date"}),e.jsx("p",{className:"font-medium",children:i.visaExpiryDate})]}),b&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Visa Image"}),e.jsx("img",{src:b,alt:"Visa",className:"w-full max-w-md h-auto rounded-md border border-gray-300"})]})]})]})]})]}):e.jsxs("form",{onSubmit:O,className:"space-y-6 bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullNameAsPerDocuments",className:"block mb-1 font-medium text-gray-700",children:"Full Name (as per documents)*"}),e.jsx("input",{type:"text",id:"fullNameAsPerDocuments",name:"fullNameAsPerDocuments",value:i.fullNameAsPerDocuments,onChange:m,className:`w-full px-3 py-2 border rounded-md ${a?"bg-gray-100 text-gray-700 cursor-not-allowed":"border-gray-300 focus:outline-none focus:ring focus:ring-indigo-200"}`,required:!0,readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dateOfBirth",className:"block mb-1 font-medium text-gray-700",children:"Date of Birth*"}),e.jsx("input",{type:"date",id:"dateOfBirth",name:"dateOfBirth",value:i.dateOfBirth,onChange:m,className:`w-full px-3 py-2 border rounded-md ${a?"bg-gray-100 text-gray-700 cursor-not-allowed":"border-gray-300 focus:outline-none focus:ring focus:ring-indigo-200"}`,required:!0,readOnly:a,disabled:a})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[e.jsx(F,{className:"mr-2 text-indigo-600"})," Passport Details"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"passportNumber",className:"block mb-1 font-medium text-gray-700",children:"Passport Number*"}),e.jsx("input",{type:"text",id:"passportNumber",name:"passportNumber",value:i.passportNumber,onChange:m,className:`w-full px-3 py-2 border rounded-md ${a?"bg-gray-100 text-gray-700 cursor-not-allowed":"border-gray-300 focus:outline-none focus:ring focus:ring-indigo-200"}`,required:!0,readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"passportExpiryDate",className:"block mb-1 font-medium text-gray-700",children:"Passport Expiry Date*"}),e.jsx("input",{type:"date",id:"passportExpiryDate",name:"passportExpiryDate",value:i.passportExpiryDate,onChange:m,className:`w-full px-3 py-2 border rounded-md ${a?"bg-gray-100 text-gray-700 cursor-not-allowed":"border-gray-300 focus:outline-none focus:ring focus:ring-indigo-200"}`,required:!0,readOnly:a,disabled:a})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block mb-1 font-medium text-gray-700",children:"Passport Image/Scan*"}),e.jsx("div",{className:"mt-2",children:h?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:h,alt:"Passport Preview",className:"w-full max-w-md h-auto rounded-md border border-gray-300"}),!a&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity rounded-md",children:e.jsxs("label",{className:"cursor-pointer bg-white text-indigo-600 px-3 py-1 rounded-md shadow hover:bg-indigo-50",children:["Change Image",e.jsx("input",{type:"file",onChange:s=>y(s,"passport"),className:"hidden",accept:"image/*,.pdf",disabled:a})]})})]}):e.jsx("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 p-6 rounded-md",children:e.jsxs("label",{className:`flex flex-col items-center ${a?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx(C,{className:"text-gray-400 text-3xl mb-2"}),e.jsx("span",{className:"text-gray-500",children:"Upload passport image"}),e.jsx("input",{type:"file",onChange:s=>y(s,"passport"),className:"hidden",accept:"image/*,.pdf",required:!(o!=null&&o.passportImageUrl),disabled:a})]})})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center",children:[e.jsx(I,{className:"mr-2 text-indigo-600"})," Visa Details"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visaNumber",className:"block mb-1 font-medium text-gray-700",children:"Visa Number*"}),e.jsx("input",{type:"text",id:"visaNumber",name:"visaNumber",value:i.visaNumber,onChange:m,className:`w-full px-3 py-2 border rounded-md ${a?"bg-gray-100 text-gray-700 cursor-not-allowed":"border-gray-300 focus:outline-none focus:ring focus:ring-indigo-200"}`,required:!0,readOnly:a,disabled:a})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visaExpiryDate",className:"block mb-1 font-medium text-gray-700",children:"Visa Expiry Date*"}),e.jsx("input",{type:"date",id:"visaExpiryDate",name:"visaExpiryDate",value:i.visaExpiryDate,onChange:m,className:`w-full px-3 py-2 border rounded-md ${a?"bg-gray-100 text-gray-700 cursor-not-allowed":"border-gray-300 focus:outline-none focus:ring focus:ring-indigo-200"}`,required:!0,readOnly:a,disabled:a})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block mb-1 font-medium text-gray-700",children:"Visa Image/Scan*"}),e.jsx("div",{className:"mt-2",children:b?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:b,alt:"Visa Preview",className:"w-full max-w-md h-auto rounded-md border border-gray-300"}),!a&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity rounded-md",children:e.jsxs("label",{className:"cursor-pointer bg-white text-indigo-600 px-3 py-1 rounded-md shadow hover:bg-indigo-50",children:["Change Image",e.jsx("input",{type:"file",onChange:s=>y(s,"visa"),className:"hidden",accept:"image/*,.pdf",disabled:a})]})})]}):e.jsx("div",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 p-6 rounded-md",children:e.jsxs("label",{className:`flex flex-col items-center ${a?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx(C,{className:"text-gray-400 text-3xl mb-2"}),e.jsx("span",{className:"text-gray-500",children:"Upload visa image"}),e.jsx("input",{type:"file",onChange:s=>y(s,"visa"),className:"hidden",accept:"image/*,.pdf",required:!(o!=null&&o.visaImageUrl),disabled:a})]})})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:x,className:`px-4 py-2 font-medium text-white rounded ${x?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:x?"Submitting...":"Submit Documents"})})]})]})};export{q as default};
