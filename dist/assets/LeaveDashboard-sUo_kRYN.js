import{r,b as y,j as e,B as j}from"./index-CvOK6pca.js";import{w as X,x as q,k as f,z as Y,A as Z,B as ee}from"./index-B8cdnCNl.js";import{M as se}from"./Modal-C1NSETwF.js";import{P as te}from"./Pagination-CcI0oFiK.js";import{f as u}from"./format-BJRZ2Kak.js";import"./en-US-D8UQXs-H.js";const ae=()=>{var L,I,P;const[p,E]=r.useState([]),[D,b]=r.useState(!0),[w,$]=r.useState(""),[O,_]=r.useState([]),[i,A]=r.useState(""),[c,C]=r.useState(""),[m,S]=r.useState(""),[x,F]=r.useState(""),[N,T]=r.useState({page:1,limit:5,total:0,pages:0}),[z,h]=r.useState(!1),[n,B]=r.useState(null),[d,M]=r.useState({status:"",hrNotes:""});r.useEffect(()=>{o(),H()},[]);const o=async(s={})=>{try{b(!0);let t=new URLSearchParams;s.employeeId&&t.append("employeeId",s.employeeId),s.status&&t.append("status",s.status),s.startDate&&t.append("startDate",s.startDate),s.endDate&&t.append("endDate",s.endDate),s.page&&t.append("page",s.page),s.limit&&t.append("limit",s.limit),s.page||t.append("page",N.page),s.limit||t.append("limit",N.limit);const{data:a}=await y.get(`/leave?${t.toString()}`);E(a.leaves),T(a.pagination),b(!1)}catch{$("Failed to fetch leave requests"),b(!1)}},H=async()=>{try{const{data:s}=await y.get("/admin/employees");_(s)}catch(s){console.error("Failed to fetch employees",s)}},U=()=>{o({employeeId:i||void 0,status:c||void 0,startDate:m||void 0,endDate:x||void 0,page:1})},G=()=>{A(""),C(""),S(""),F(""),o()},J=s=>{o({employeeId:i||void 0,status:c||void 0,startDate:m||void 0,endDate:x||void 0,page:s})},v=(s,t)=>{B(s),M({status:t||s.status,hrNotes:s.hrNotes||""}),h(!0)},R=s=>{const{name:t,value:a}=s.target;M(l=>({...l,[t]:a}))},K=async s=>{var t,a;s.preventDefault();try{await y.put(`/leave/${n._id}`,d),j.success(`Leave request ${d.status.toLowerCase()} successfully`),h(!1),o({employeeId:i||void 0,status:c||void 0,startDate:m||void 0,endDate:x||void 0})}catch(l){const g=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||`Failed to ${d.status.toLowerCase()} leave request`;j.error(g)}},Q=async s=>{var t,a;if(window.confirm("Are you sure you want to delete this leave request?"))try{await y.delete(`/leave/${s}`),j.success("Leave request deleted successfully"),o({employeeId:i||void 0,status:c||void 0,startDate:m||void 0,endDate:x||void 0})}catch(l){j.error(((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to delete leave request")}},V=s=>{switch(s){case"Approved":return"bg-green-100 text-green-800";case"Rejected":return"bg-red-100 text-red-800";case"Pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},W=s=>{switch(s){case"Approved":return e.jsx(ee,{className:"mr-1"});case"Rejected":return e.jsx(Z,{className:"mr-1"});case"Pending":return e.jsx(Y,{className:"mr-1"});default:return null}};return D&&p.length===0?e.jsx("div",{className:"flex justify-center p-8",children:"Loading leave requests..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Employee Leave Requests"}),e.jsxs("div",{className:"bg-white shadow rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"employee",className:"block mb-1 text-sm font-medium text-gray-700",children:[e.jsx(X,{className:"inline mr-1"})," Employee"]}),e.jsxs("select",{id:"employee",value:i,onChange:s=>A(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Employees"}),O.map(s=>e.jsxs("option",{value:s._id,children:[s.firstName," ",s.lastName]},s._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"status",className:"block mb-1 text-sm font-medium text-gray-700",children:[e.jsx(q,{className:"inline mr-1"})," Status"]}),e.jsxs("select",{id:"status",value:c,onChange:s=>C(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"startDate",className:"block mb-1 text-sm font-medium text-gray-700",children:[e.jsx(f,{className:"inline mr-1"})," From Date"]}),e.jsx("input",{type:"date",id:"startDate",value:m,onChange:s=>S(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"endDate",className:"block mb-1 text-sm font-medium text-gray-700",children:[e.jsx(f,{className:"inline mr-1"})," To Date"]}),e.jsx("input",{type:"date",id:"endDate",value:x,onChange:s=>F(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsxs("button",{onClick:U,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(q,{className:"inline mr-2"})," Filter"]}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Reset"})]})]}),w&&e.jsx("div",{className:"p-3 mb-4 text-white bg-red-500 rounded",children:w}),p.length===0?e.jsxs("div",{className:"bg-white shadow rounded-lg p-8 text-center text-gray-500",children:[e.jsx(f,{className:"mx-auto text-gray-300",size:40}),e.jsx("p",{className:"mt-2",children:"No leave requests found"})]}):e.jsx("div",{className:"space-y-4",children:p.map(s=>{var t,a,l,g,k;return e.jsxs("div",{className:`bg-white rounded-lg shadow p-4 border-l-4 ${s.status==="Pending"?"border-yellow-500":s.status==="Approved"?"border-green-500":"border-red-500"}`,children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-start mb-3",children:[e.jsxs("div",{className:"mb-2 md:mb-0",children:[e.jsxs("h4",{className:"font-medium",children:[(t=s.employeeId)==null?void 0:t.firstName," ",(a=s.employeeId)==null?void 0:a.lastName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[(l=s.employeeId)==null?void 0:l.department," â€¢ ",(g=s.employeeId)==null?void 0:g.position]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",(k=s.employeeId)==null?void 0:k._id]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium mb-2 flex items-center ${V(s.status)}`,children:[W(s.status)," ",s.status]}),s.status==="Pending"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>v(s,"Approved"),className:"px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600",children:"Approve"}),e.jsx("button",{onClick:()=>v(s,"Rejected"),className:"px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600",children:"Reject"})]}),s.status!=="Pending"&&e.jsx("button",{onClick:()=>v(s),className:"px-2 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600",children:"Update"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"Leave Duration"}),e.jsxs("p",{className:"text-sm",children:[u(new Date(s.startDate),"MMM dd, yyyy")," - ",u(new Date(s.endDate),"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-xs text-gray-700 font-medium",children:[s.numberOfDays," ",s.numberOfDays>1?"days":"day"]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"Leave Type"}),e.jsx("p",{className:"text-sm font-medium",children:s.leaveType})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"Applied On"}),e.jsx("p",{className:"text-sm",children:u(new Date(s.createdAt),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"Reason"}),e.jsx("p",{className:"text-sm",children:s.reason})]}),s.hrNotes&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"HR Notes"}),e.jsx("p",{className:"text-sm",children:s.hrNotes})]}),e.jsx("div",{className:"mt-3 text-right",children:e.jsx("button",{onClick:()=>Q(s._id),className:"text-xs text-red-600 hover:text-red-800",children:"Delete"})})]},s._id)})}),!D&&p.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(te,{pagination:N,onPageChange:J})})]}),e.jsx(se,{isOpen:z,onClose:()=>h(!1),title:`${d.status} Leave Request`,children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[n&&e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[e.jsx("h4",{className:"text-md font-medium",children:"Employee Details"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[(L=n.employeeId)==null?void 0:L.firstName," ",(I=n.employeeId)==null?void 0:I.lastName]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",(P=n.employeeId)==null?void 0:P._id]}),e.jsxs("p",{className:"text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Leave Period:"})," ",u(new Date(n.startDate),"MMM dd, yyyy")," - ",u(new Date(n.endDate),"MMM dd, yyyy")]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Duration:"})," ",n.numberOfDays," days"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",n.reason]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block mb-1 font-medium text-gray-700",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:d.status,onChange:R,className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Approved",children:"Approved"}),e.jsx("option",{value:"Rejected",children:"Rejected"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hrNotes",className:"block mb-1 font-medium text-gray-700",children:"HR Notes"}),e.jsx("textarea",{id:"hrNotes",name:"hrNotes",value:d.hrNotes,onChange:R,placeholder:"Add notes for employee (optional)",className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"3"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:`px-4 py-2 text-white rounded ${d.status==="Approved"?"bg-green-600 hover:bg-green-700":d.status==="Rejected"?"bg-red-600 hover:bg-red-700":"bg-blue-600 hover:bg-blue-700"}`,children:d.status==="Pending"?"Mark as Pending":d.status==="Approved"?"Approve Leave":"Reject Leave"})]})]})})]})},ce=()=>e.jsxs("div",{children:[e.jsx("h2",{className:"mb-6 text-2xl font-semibold",children:"Leave Management"}),e.jsx(ae,{})]});export{ce as default};
