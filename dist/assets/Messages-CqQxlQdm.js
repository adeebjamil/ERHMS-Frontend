import{u as b,r as t,b as n,B as r,j as e}from"./index-CvOK6pca.js";import{J as N,g as y}from"./index-B8cdnCNl.js";import{M,a as w}from"./MessageForm-DL23UPW_.js";import"./format-BJRZ2Kak.js";import"./en-US-D8UQXs-H.js";const F=()=>{const{currentUser:S}=b(),[o,m]=t.useState([]),[u,i]=t.useState(!0),[g,f]=t.useState([]),[d,x]=t.useState(null);t.useEffect(()=>{p(),h();const s=setInterval(h,3e4);return()=>clearInterval(s)},[]);const p=async()=>{try{const{data:s}=await n.get("/messages/users");f(s),s.length>0&&x(s[0]._id)}catch(s){console.error("Failed to fetch admins:",s),r.error("Failed to load admins")}},h=async()=>{try{i(!0);const[s,l]=await Promise.all([n.get("/messages"),n.get("/messages/public")]),c=[...s.data,...l.data].sort((a,v)=>new Date(a.createdAt)-new Date(v.createdAt));m(c),i(!1)}catch(s){console.error("Failed to fetch messages:",s),i(!1),r.error("Failed to load messages")}},j=async s=>{var l,c;if(!d){r.error("Please select an admin to message");return}try{const{data:a}=await n.post("/messages",{receiverId:d,content:s,isPublic:!1});m([...o,a]),r.success("Message sent successfully")}catch(a){r.error(((c=(l=a.response)==null?void 0:l.data)==null?void 0:c.message)||"Failed to send message")}};return u&&o.length===0?e.jsx("div",{className:"flex justify-center p-8",children:"Loading messages..."}):g.length===0?e.jsxs("div",{className:"bg-white shadow rounded-lg p-8 text-center",children:[e.jsx(N,{className:"mx-auto text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-medium mb-2",children:"No HR Contacts Available"}),e.jsx("p",{className:"text-gray-600",children:"There are currently no HR contacts available to message. Please check back later."})]}):e.jsxs("div",{className:"bg-white shadow rounded-lg flex flex-col h-[calc(100vh-13rem)]",children:[e.jsxs("div",{className:"border-b p-4 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Messaging"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:"admin-select",className:"block text-sm font-medium text-gray-700 mb-1",children:"Send Message To:"}),e.jsx("select",{id:"admin-select",value:d||"",onChange:s=>x(s.target.value),className:"w-full p-2 border rounded-md",children:g.map(s=>e.jsxs("option",{value:s._id,children:[s.username," (HR)"]},s._id))})]})]}),e.jsx(M,{messages:o}),e.jsx(w,{onSendMessage:j})]})},k=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{className:"mr-2 text-indigo-600 text-xl"}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Messages"})]}),e.jsx("p",{className:"text-gray-600",children:"Send and receive messages with HR staff."}),e.jsx(F,{})]});export{k as default};
