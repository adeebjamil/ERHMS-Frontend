import{r as o,b as M,B as $,j as e}from"./index-CvOK6pca.js";import{u as q,x as G,f as S,r as J,n as Q,T as A,V as W}from"./index-B8cdnCNl.js";import{n as X}from"./en-US-D8UQXs-H.js";import{d as Z,f as j}from"./format-BJRZ2Kak.js";function ee(d,n,m){const[x,v]=X(m==null?void 0:m.in,d,n),u=U(x,v),p=Math.abs(Z(x,v));x.setDate(x.getDate()-u*p);const E=+(U(x,v)===-u),f=u*(p-E);return f===0?0:f}function U(d,n){const m=d.getFullYear()-n.getFullYear()||d.getMonth()-n.getMonth()||d.getDate()-n.getDate()||d.getHours()-n.getHours()||d.getMinutes()-n.getMinutes()||d.getSeconds()-n.getSeconds()||d.getMilliseconds()-n.getMilliseconds();return m<0?-1:m>0?1:m}const ie=()=>{const d=o.useRef(!1),n=o.useRef(new Set),[m,x]=o.useState([]),[v,u]=o.useState(!0),[p,E]=o.useState("all"),[f,R]=o.useState(""),[a,z]=o.useState(null),[T,I]=o.useState(!1),[h,N]=o.useState(1),[b,B]=o.useState(1);o.useEffect(()=>{k()},[p,h]),o.useEffect(()=>{d.current||(K(),d.current=!0)},[]);const k=async()=>{try{u(!0);const s=new URLSearchParams;s.append("page",h),s.append("limit",10),p!=="all"&&s.append("expiryStatus",p),f&&s.append("search",f);const{data:r}=await M.get(`/admin/travel-documents?${s.toString()}`);x(r.documents),B(r.pagination.pages)}catch(s){console.error("Error fetching documents:",s),$.error("Failed to fetch travel documents")}finally{u(!1)}},H=s=>{s.preventDefault(),N(1),k()},L=s=>{E(s.target.value),N(1)},c=s=>{const r=new Date,t=new Date(s);return ee(t,r)},w=s=>s<0?e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-red-100 text-red-800",children:["Expired ",Math.abs(s)," days ago"]}):s<=30?e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800",children:["Expires in ",s," days"]}):s<=90?e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800",children:["Expires in ",s," days"]}):e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",children:["Valid (",s," days left)"]}),O=s=>{z(s),I(!0)},C=(s,r)=>{const t=document.createElement("a");t.href=`${"https://ehrms-backend.onrender.com/api".replace("/api","")}${s}`,t.download=`${r}_${new Date().getTime()}.jpg`,document.body.appendChild(t),t.click(),document.body.removeChild(t)},P=async(s,r,t,l)=>{try{const i=j(new Date(l),"MMMM dd, yyyy"),g=`${r}'s ${t} will expire in 10 days on ${i}.`;await M.post("/notifications/admin",{type:"document",message:g,employeeId:s,metadata:{documentType:t,expiryDate:l}})}catch(i){console.error(`Error creating ${t} expiry notification:`,i)}},_=(s,r,t,l)=>{const i=`${r}_${l}_${t}`;$.isActive(i)||$.error(e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center font-bold mb-1",children:[e.jsx(W,{className:"mr-2 text-yellow-400"}),"Critical Document Expiry Alert"]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[s,"'s ",r]})," expires in ",e.jsx("strong",{children:t})," ",t===1?"day":"days","!"]})]}),{position:"top-right",autoClose:1e4,closeOnClick:!1,pauseOnHover:!0,draggable:!0,className:"border-l-4 border-red-500",toastId:i})},K=async()=>{try{const s=new URLSearchParams;s.append("expiryStatus","all");const{data:r}=await M.get(`/admin/travel-documents?${s.toString()}`),t=r.documents,l=t.filter(i=>{const g=c(i.passportExpiryDate),y=c(i.visaExpiryDate);return g<=10&&g>=0||y<=10&&y>=0});l.length>0&&l.forEach(i=>{const g=`${i.employeeId.firstName} ${i.employeeId.lastName}`,y=c(i.passportExpiryDate),D=c(i.visaExpiryDate),F=`passport_${i._id}_${y}`,V=`visa_${i._id}_${D}`;y<=10&&y>=0&&!n.current.has(F)&&(_(g,"passport",y,i._id),n.current.add(F)),D<=10&&D>=0&&!n.current.has(V)&&(_(g,"visa",D,i._id),n.current.add(V))}),await Y(t)}catch(s){console.error("Error checking for critical expiring documents:",s)}},Y=async s=>{try{const r=s.filter(t=>{const l=c(t.passportExpiryDate),i=c(t.visaExpiryDate);return l===10||i===10});for(const t of r){const l=`${t.employeeId.firstName} ${t.employeeId.lastName}`;c(t.passportExpiryDate)===10&&await P(t.employeeId._id,l,"passport",t.passportExpiryDate),c(t.visaExpiryDate)===10&&await P(t.employeeId._id,l,"visa",t.visaExpiryDate)}}catch(r){console.error("Error creating server notifications:",r)}};return v&&m.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})}):e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Visa & Passport Management"}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6 flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("form",{onSubmit:H,className:"flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by name or document number...",value:f,onChange:s=>R(s.target.value),className:"pl-10 pr-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsx("button",{type:"submit",className:"ml-2 bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700",children:"Search"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"text-gray-400"}),e.jsxs("select",{value:p,onChange:L,className:"border rounded-md px-3 py-2 focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"all",children:"All Documents"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"expiring-soon",children:"Expiring within 30 days"}),e.jsx("option",{value:"approaching",children:"Expiring within 90 days"}),e.jsxs("option",{value:"valid",children:["Valid (",">"," 90 days)"]})]})]})]}),m.length===0?e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow text-center",children:[e.jsx(S,{className:"mx-auto text-gray-300 text-6xl mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No travel documents found"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Try adjusting your search criteria"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Passport Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Visa Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(s=>{const r=c(s.passportExpiryDate),t=c(s.visaExpiryDate);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-14 w-14",children:e.jsx("img",{className:"h-14 w-14 rounded-full object-cover",src:s.employeeId.profileImage?`${"https://ehrms-backend.onrender.com/api".replace("/api","")}${s.employeeId.profileImage}`:"/default-avatar.png",alt:"",onError:l=>{l.target.src="/default-avatar.png"}})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[s.employeeId.firstName," ",s.employeeId.lastName]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.employeeId.email})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:["Number: ",s.passportNumber]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Expires: ",j(new Date(s.passportExpiryDate),"MMM dd, yyyy")]}),e.jsx("div",{className:"mt-1",children:w(r)})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:["Number: ",s.visaNumber]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Expires: ",j(new Date(s.visaExpiryDate),"MMM dd, yyyy")]}),e.jsx("div",{className:"mt-1",children:w(t)})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("button",{onClick:()=>O(s),className:"text-indigo-600 hover:text-indigo-900",children:[e.jsx(J,{className:"inline mr-1"})," View Details"]})})]},s._id)})})]})}),b>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[e.jsx("button",{onClick:()=>N(Math.max(1,h-1)),disabled:h===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),[...Array(b)].map((s,r)=>e.jsx("button",{onClick:()=>N(r+1),className:`relative inline-flex items-center px-4 py-2 border ${h===r+1?"bg-indigo-50 border-indigo-500 text-indigo-600":"border-gray-300 bg-white text-gray-500 hover:bg-gray-50"} text-sm font-medium`,children:r+1},r)),e.jsx("button",{onClick:()=>N(Math.min(b,h+1)),disabled:h===b,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]}),T&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Travel Document Details"}),e.jsx("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-500",children:"×"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-medium mb-2",children:"Employee Information"}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsx("img",{src:a.employeeId.profileImage?`${"https://ehrms-backend.onrender.com/api".replace("/api","")}${a.employeeId.profileImage}`:"/default-avatar.png",alt:"",className:"h-24 w-24 rounded-full object-cover",onError:s=>{s.target.src="/default-avatar.png"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"text-xl text-gray-900 font-medium",children:[a.employeeId.firstName," ",a.employeeId.lastName]}),e.jsx("div",{className:"text-gray-600",children:a.employeeId.email}),e.jsxs("div",{className:"text-gray-600",children:[a.employeeId.department," • ",a.employeeId.position]})]}),e.jsx("div",{className:"flex flex-col gap-3 mt-2 md:mt-0",children:a.employeeId.phone&&e.jsxs("a",{href:`tel:${a.employeeId.phone}`,className:"flex items-center justify-center gap-2 bg-gradient-to-r from-gray-500 to-gray-600 text-white px-4 py-2 rounded-md hover:shadow-lg transition-all duration-200 w-full",children:[e.jsx(Q,{size:20,className:"text-white"}),e.jsx("span",{children:"Call"})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h4",{className:"text-lg font-medium mb-4 flex items-center",children:[e.jsx(S,{className:"mr-2 text-indigo-600"})," Passport"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Full Name (as per passport)"}),e.jsx("div",{className:"font-medium",children:a.fullNameAsPerDocuments})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Date of Birth"}),e.jsx("div",{className:"font-medium",children:j(new Date(a.dateOfBirth),"MMMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Passport Number"}),e.jsx("div",{className:"font-medium",children:a.passportNumber})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Expiry Date"}),e.jsx("div",{className:"font-medium",children:j(new Date(a.passportExpiryDate),"MMMM dd, yyyy")}),e.jsx("div",{className:"mt-1",children:w(c(a.passportExpiryDate))})]}),a.passportImageUrl&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-500 mb-2 flex justify-between items-center",children:[e.jsx("span",{children:"Passport Image"}),e.jsx("button",{onClick:()=>C(a.passportImageUrl,"passport"),className:"text-indigo-600 hover:text-indigo-800",title:"Download Passport",children:e.jsx(A,{size:16})})]}),e.jsx("img",{src:`${"https://ehrms-backend.onrender.com/api".replace("/api","")}${a.passportImageUrl}`,alt:"Passport",className:"max-w-full h-auto rounded border"})]})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("h4",{className:"text-lg font-medium mb-4 flex items-center",children:[e.jsx(S,{className:"mr-2 text-indigo-600"})," Visa"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Visa Number"}),e.jsx("div",{className:"font-medium",children:a.visaNumber})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Expiry Date"}),e.jsx("div",{className:"font-medium",children:j(new Date(a.visaExpiryDate),"MMMM dd, yyyy")}),e.jsx("div",{className:"mt-1",children:w(c(a.visaExpiryDate))})]}),a.visaImageUrl&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-500 mb-2 flex justify-between items-center",children:[e.jsx("span",{children:"Visa Image"}),e.jsx("button",{onClick:()=>C(a.visaImageUrl,"visa"),className:"text-indigo-600 hover:text-indigo-800",title:"Download Visa",children:e.jsx(A,{size:16})})]}),e.jsx("img",{src:`${"https://ehrms-backend.onrender.com/api".replace("/api","")}${a.visaImageUrl}`,alt:"Visa",className:"max-w-full h-auto rounded border"})]})]})]})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:()=>I(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Close"})})]})})]})};export{ie as default};
