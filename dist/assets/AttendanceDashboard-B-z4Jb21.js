import{r as d,b as x,j as e,B as p}from"./index-CvOK6pca.js";import{w as se,k as q,x as de,y as ne,t as le}from"./index-B8cdnCNl.js";import{M as re}from"./Modal-C1NSETwF.js";import{P as ie}from"./Pagination-CcI0oFiK.js";import{P as h}from"./constants-C-b4r1xk.js";import{g as U}from"./helpers-CaOlnEck.js";import{f as N}from"./format-BJRZ2Kak.js";import"./en-US-D8UQXs-H.js";const oe=()=>{var F,S,A,M,P,R,_,$;const[i,v]=d.useState([]),[w,u]=d.useState(!0),[D,B]=d.useState(""),[G,z]=d.useState([]),[y,I]=d.useState(""),[g,E]=d.useState(""),[f,k]=d.useState(""),[j,J]=d.useState({page:1,limit:10,total:0,pages:0}),[K,o]=d.useState(!1),[n,Q]=d.useState(null),[c,C]=d.useState({date:"",status:"",notes:""});d.useEffect(()=>{r(),V()},[]);const r=async(t={})=>{try{u(!0);let a=new URLSearchParams;t.employeeId&&a.append("employeeId",t.employeeId),t.startDate&&a.append("startDate",t.startDate),t.endDate&&a.append("endDate",t.endDate),t.page&&a.append("page",t.page),t.limit&&a.append("limit",t.limit),t.page||a.append("page",j.page),t.limit||a.append("limit",j.limit);const{data:s}=await x.get(`/attendance?${a.toString()}`);v(s.attendance),J(s.pagination),u(!1)}catch{B("Failed to fetch attendance records"),u(!1)}},V=async()=>{try{const{data:t}=await x.get("/admin/employees");z(t)}catch(t){console.error("Failed to fetch employees",t)}},W=()=>{r({employeeId:y||void 0,startDate:g||void 0,endDate:f||void 0,page:1})},X=()=>{I(""),E(""),k(""),r()},Y=t=>{r({employeeId:y||void 0,startDate:g||void 0,endDate:f||void 0,page:t})},Z=t=>{Q(t),C({date:N(new Date(t.date),"yyyy-MM-dd"),status:t.status,notes:t.notes||""}),o(!0)},b=t=>{const{name:a,value:s}=t.target;C(l=>({...l,[a]:s}))},ee=async t=>{var a,s;t.preventDefault();try{await x.put(`/attendance/${n._id}`,c),p.success("Attendance record updated successfully"),o(!1),r()}catch(l){p.error(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to update attendance record")}},te=async t=>{var a,s;if(window.confirm("Are you sure you want to delete this attendance record?"))try{await x.delete(`/attendance/${t}`),p.success("Attendance record deleted successfully"),v(l=>l.filter(m=>m._id!==t))}catch(l){p.error(((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to delete attendance record")}},ae=t=>{switch(t){case"Present":return"bg-green-100 text-green-800";case"Absent":return"bg-red-100 text-red-800";case"Half-day":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return w&&i.length===0?e.jsx("div",{className:"flex justify-center p-8",children:"Loading attendance records..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Employee Attendance Records"}),e.jsx("div",{className:"bg-white shadow rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"employee",className:"block mb-1 text-sm font-medium text-gray-700",children:[e.jsx(se,{className:"inline mr-1"})," Employee"]}),e.jsxs("select",{id:"employee",value:y,onChange:t=>I(t.target.value),className:"w-full min-w-[200px] px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"All Employees"}),G.map(t=>e.jsxs("option",{value:t._id,children:[t.firstName," ",t.lastName]},t._id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"startDate",className:"block mb-1 text-sm font-medium text-gray-700",children:[e.jsx(q,{className:"inline mr-1"})," From Date"]}),e.jsx("input",{type:"date",id:"startDate",value:g,onChange:t=>E(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"endDate",className:"block mb-1 text-sm font-medium text-gray-700",children:[e.jsx(q,{className:"inline mr-1"})," To Date"]}),e.jsx("input",{type:"date",id:"endDate",value:f,onChange:t=>k(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:W,className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(de,{className:"mr-2"})," Filter"]}),e.jsx("button",{onClick:X,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Reset"})]})]})}),D&&e.jsx("div",{className:"p-3 mb-4 text-white bg-red-500 rounded",children:D}),e.jsx("div",{className:"overflow-x-auto bg-white shadow rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check-in Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Notes"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-4 text-center text-gray-500",children:"No attendance records found"})}):i.map(t=>{var a,s,l,m,L,H,O;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-xs font-medium bg-gray-100 text-gray-800 px-2 py-1 rounded-full",children:(a=t.employeeId)==null?void 0:a._id})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 mr-3",children:e.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:(s=t.employeeId)!=null&&s.profileImage?U(t.employeeId.profileImage):h,alt:`${(l=t.employeeId)==null?void 0:l.firstName} ${(m=t.employeeId)==null?void 0:m.lastName}`,onError:T=>{T.target.onerror=null,T.target.src=h}})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[(L=t.employeeId)==null?void 0:L.firstName," ",(H=t.employeeId)==null?void 0:H.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:(O=t.employeeId)==null?void 0:O.department})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:N(new Date(t.date),"MMM dd, yyyy")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${ae(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:N(new Date(t.checkInTime),"hh:mm a")}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:t.notes||"-"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>Z(t),className:"text-indigo-600 hover:text-indigo-900 mr-3",title:"Edit attendance",children:e.jsx(ne,{})}),e.jsx("button",{onClick:()=>te(t._id),className:"text-red-600 hover:text-red-900",title:"Delete attendance",children:e.jsx(le,{})})]})]},t._id)})})]})}),!w&&i.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(ie,{pagination:j,onPageChange:Y})})]}),e.jsx(re,{isOpen:K,onClose:()=>o(!1),title:"Edit Attendance Record",children:e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[n&&e.jsx("div",{className:"mb-4 pb-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-12 w-12 flex-shrink-0 mr-3 rounded-full overflow-hidden",children:e.jsx("img",{className:"h-12 w-12 object-cover",src:(F=n.employeeId)!=null&&F.profileImage?U(n.employeeId.profileImage):h,alt:`${(S=n.employeeId)==null?void 0:S.firstName} ${(A=n.employeeId)==null?void 0:A.lastName}`,onError:t=>{t.target.onerror=null,t.target.src=h}})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-md font-medium",children:[(M=n.employeeId)==null?void 0:M.firstName," ",(P=n.employeeId)==null?void 0:P.lastName]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",(R=n.employeeId)==null?void 0:R._id]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(_=n.employeeId)==null?void 0:_.department," â€¢ ",(($=n.employeeId)==null?void 0:$.position)||""]})]})]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-date",className:"block mb-1 font-medium text-gray-700",children:"Date"}),e.jsx("input",{type:"date",id:"edit-date",name:"date",value:c.date,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-status",className:"block mb-1 font-medium text-gray-700",children:"Status"}),e.jsxs("select",{id:"edit-status",name:"status",value:c.status,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[e.jsx("option",{value:"Present",children:"Present"}),e.jsx("option",{value:"Absent",children:"Absent"}),e.jsx("option",{value:"Half-day",children:"Half-day"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-notes",className:"block mb-1 font-medium text-gray-700",children:"Notes"}),e.jsx("textarea",{id:"edit-notes",name:"notes",value:c.notes,onChange:b,className:"w-full px-3 py-2 border border-gray-300 rounded-md",rows:"3"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"Save Changes"})]})]})})]})},fe=()=>e.jsxs("div",{children:[e.jsx("h2",{className:"mb-6 text-2xl font-semibold",children:"Attendance Management"}),e.jsx(oe,{})]});export{fe as default};
