import{r as t,b as p,j as e,B as v}from"./index-CvOK6pca.js";import{t as D}from"./en-US-D8UQXs-H.js";import{f as h}from"./format-BJRZ2Kak.js";import{d as w,z as L,A as M,B as S}from"./index-B8cdnCNl.js";import{P as C}from"./Pagination-CcI0oFiK.js";function F(m,s){const l=D(m,s==null?void 0:s.in).getDay();return l===0||l===6}const k=({onLeaveApplied:m})=>{const[s,l]=t.useState({startDate:h(new Date,"yyyy-MM-dd"),endDate:h(new Date,"yyyy-MM-dd"),numberOfDays:1,leaveType:"Casual Leave",reason:""}),[o,u]=t.useState(!1),[d,j]=t.useState(null),[y,i]=t.useState("");t.useEffect(()=>{f()},[]),t.useEffect(()=>{if(s.startDate&&s.endDate){const r=new Date(s.startDate),a=new Date(s.endDate);if(a<r){l(x=>({...x,endDate:s.startDate,numberOfDays:1}));return}let n=0;const c=new Date(r);for(;c<=a;)F(c)||n++,c.setDate(c.getDate()+1);l(x=>({...x,numberOfDays:n}))}},[s.startDate,s.endDate]);const f=async()=>{try{const{data:r}=await p.get("/leave/my-balance");j(r)}catch(r){console.error("Failed to fetch leave balance:",r),i("Failed to fetch your leave balance")}},g=r=>{const{name:a,value:n}=r.target;l(c=>({...c,[a]:n}))},b=()=>!s.startDate||!s.endDate?(i("Please select start and end dates"),!1):new Date(s.endDate)<new Date(s.startDate)?(i("End date cannot be before start date"),!1):s.leaveType?s.reason.trim()?d&&s.numberOfDays>d.remainingLeaves?(i(`Insufficient leave balance. You have only ${d.remainingLeaves} days remaining.`),!1):(i(""),!0):(i("Please provide a reason for your leave"),!1):(i("Please select a leave type"),!1),N=async r=>{var a,n;if(r.preventDefault(),!!b()){u(!0);try{await p.post("/leave",s),v.success("Leave application submitted successfully!"),l({startDate:h(new Date,"yyyy-MM-dd"),endDate:h(new Date,"yyyy-MM-dd"),numberOfDays:1,leaveType:"Casual Leave",reason:""}),f(),m&&m()}catch(c){const x=((n=(a=c.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to submit leave application";v.error(x),i(x)}finally{u(!1)}}};return e.jsxs("div",{className:"bg-white rounded-lg",children:[y&&e.jsx("div",{className:"p-3 mb-4 text-white bg-red-500 rounded",children:y}),d&&e.jsxs("div",{className:"p-4 mb-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("h4",{className:"text-lg font-medium text-blue-800",children:"Leave Balance"}),e.jsxs("div",{className:"flex justify-between mt-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-blue-600",children:["Total: ",d.totalLeaves," days"]}),e.jsxs("p",{className:"text-sm text-blue-600",children:["Used: ",d.usedLeaves," days"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-semibold text-blue-800",children:["Remaining: ",d.remainingLeaves," days"]}),e.jsxs("p",{className:"text-xs text-blue-600",children:["Year: ",d.year]})]})]})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block mb-1 font-medium text-gray-700",children:"Start Date*"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",value:s.startDate,onChange:g,min:h(new Date,"yyyy-MM-dd"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block mb-1 font-medium text-gray-700",children:"End Date*"}),e.jsx("input",{type:"date",id:"endDate",name:"endDate",value:s.endDate,onChange:g,min:s.startDate,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!0})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-20 h-20 flex items-center justify-center bg-gray-100 rounded-full",children:e.jsx("span",{className:"text-2xl font-bold text-indigo-600",children:s.numberOfDays})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h4",{className:"font-medium text-gray-700",children:"Number of Working Days"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Weekends are automatically excluded"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"leaveType",className:"block mb-1 font-medium text-gray-700",children:"Leave Type*"}),e.jsxs("select",{id:"leaveType",name:"leaveType",value:s.leaveType,onChange:g,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",required:!0,children:[e.jsx("option",{value:"Casual Leave",children:"Casual Leave"}),e.jsx("option",{value:"Sick Leave",children:"Sick Leave"}),e.jsx("option",{value:"Vacation",children:"Vacation"}),e.jsx("option",{value:"Emergency",children:"Emergency"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reason",className:"block mb-1 font-medium text-gray-700",children:"Reason*"}),e.jsx("textarea",{id:"reason",name:"reason",value:s.reason,onChange:g,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring focus:ring-indigo-200",rows:"3",placeholder:"Please provide a detailed reason for your leave request...",required:!0})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:o,className:`w-full px-4 py-2 font-medium text-white rounded ${o?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:o?"Submitting...":"Submit Leave Application"})})]})]})},T=({refreshTrigger:m})=>{const[s,l]=t.useState([]),[o,u]=t.useState(!0),[d,j]=t.useState(""),[y,i]=t.useState({page:1,limit:5,total:0,pages:0});t.useEffect(()=>{f()},[m,y.page]);const f=async()=>{try{u(!0);const{data:a}=await p.get(`/leave/my-leaves?page=${y.page}&limit=${y.limit}`);l(a.leaves),i(a.pagination),u(!1)}catch{j("Failed to fetch leave records"),u(!1)}},g=async a=>{var n,c;if(window.confirm("Are you sure you want to cancel this leave request?"))try{await p.delete(`/leave/${a}`),v.success("Leave request cancelled successfully"),f()}catch(x){v.error(((c=(n=x.response)==null?void 0:n.data)==null?void 0:c.message)||"Failed to cancel leave request")}},b=a=>{i(n=>({...n,page:a}))},N=a=>{switch(a){case"Approved":return e.jsx(S,{className:"text-green-600"});case"Rejected":return e.jsx(M,{className:"text-red-600"});case"Pending":return e.jsx(L,{className:"text-yellow-600"});default:return null}},r=a=>{switch(a){case"Approved":return"bg-green-100 text-green-800";case"Rejected":return"bg-red-100 text-red-800";case"Pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return o&&s.length===0?e.jsx("div",{className:"flex justify-center items-center h-32",children:"Loading leave records..."}):d?e.jsx("div",{className:"p-3 mb-4 text-white bg-red-500 rounded",children:d}):s.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(w,{className:"mx-auto text-gray-300",size:40}),e.jsx("p",{className:"mt-2",children:"No leave records found"}),e.jsx("p",{className:"text-sm",children:"Apply for leave using the form above"})]}):e.jsxs("div",{className:"space-y-4",children:[s.map(a=>e.jsxs("div",{className:"p-4 bg-white rounded-lg shadow-sm border-l-4 border-indigo-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.leaveType}),e.jsxs("p",{className:"text-sm text-gray-600",children:[h(new Date(a.startDate),"MMM dd, yyyy")," - ",h(new Date(a.endDate),"MMM dd, yyyy")]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center ${r(a.status)}`,children:[N(a.status),e.jsx("span",{className:"ml-1",children:a.status})]})})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"Duration"}),e.jsxs("p",{className:"text-sm font-medium",children:[a.numberOfDays," ",a.numberOfDays>1?"days":"day"]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"Applied On"}),e.jsx("p",{className:"text-sm font-medium",children:h(new Date(a.createdAt),"MMM dd, yyyy")})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"Reason"}),e.jsx("p",{className:"text-sm",children:a.reason})]}),a.hrNotes&&e.jsxs("div",{className:"mt-3 p-2 bg-gray-50 rounded",children:[e.jsx("h5",{className:"text-xs text-gray-500",children:"HR Notes"}),e.jsx("p",{className:"text-sm",children:a.hrNotes})]}),a.status==="Pending"&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:()=>g(a._id),className:"text-xs text-red-600 hover:text-red-800",children:"Cancel Request"})})]},a._id)),!o&&s.length>0&&e.jsx("div",{className:"mt-6",children:e.jsx(C,{pagination:y,onPageChange:b})})]})},q=()=>{const[m,s]=t.useState(0);t.useEffect(()=>{(async()=>{try{await p.put("/leave/mark-updates-read")}catch(u){console.error("Failed to mark leave updates as read:",u)}})()},[]);const l=()=>{s(o=>o+1)};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"My Leaves"}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Apply for Leave"}),e.jsx(k,{onLeaveApplied:l})]}),e.jsxs("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Leave History"})}),e.jsx("div",{className:"p-6",children:e.jsx(T,{refreshTrigger:m})})]})]})};export{q as default};
