import{r as D,b as M,B as g,j as n}from"./index-CvOK6pca.js";import{B as k,h as F,E as _,f as A,j as E,g as R,d as X,c as O}from"./index-B8cdnCNl.js";import{P as b}from"./constants-C-b4r1xk.js";import{g as C}from"./helpers-CaOlnEck.js";import{t as x,c as L,n as v,g as I,a as T,e as Y,m as w,b as N}from"./en-US-D8UQXs-H.js";function j(a,s){const e=+x(a)-+x(s);return e<0?-1:e>0?1:e}function H(a){return L(a,Date.now())}function B(a,s,e){const[l,r]=v(e==null?void 0:e.in,a,s),f=l.getFullYear()-r.getFullYear(),d=l.getMonth()-r.getMonth();return f*12+d}function z(a){return s=>{const l=(a?Math[a]:Math.trunc)(s);return l===0?0:l}}function P(a,s){return+x(a)-+x(s)}function U(a,s){const e=x(a,s==null?void 0:s.in);return e.setHours(23,59,59,999),e}function p(a,s){const e=x(a,s==null?void 0:s.in),l=e.getMonth();return e.setFullYear(e.getFullYear(),l+1,0),e.setHours(23,59,59,999),e}function $(a,s){const e=x(a,s==null?void 0:s.in);return+U(e,s)==+p(e,s)}function G(a,s,e){const[l,r,f]=v(e==null?void 0:e.in,a,a,s),d=j(r,f),c=Math.abs(B(r,f));if(c<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-d*c);let t=j(r,f)===-d;$(l)&&c===1&&j(l,f)===1&&(t=!1);const i=d*(c-+t);return i===0?0:i}function V(a,s,e){const l=P(a,s)/1e3;return z(e==null?void 0:e.roundingMethod)(l)}function q(a,s,e){const l=T(),r=(e==null?void 0:e.locale)??l.locale??Y,f=2520,d=j(a,s);if(isNaN(d))throw new RangeError("Invalid time value");const c=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:d}),[t,i]=v(e==null?void 0:e.in,...d>0?[s,a]:[a,s]),u=V(i,t),S=(I(i)-I(t))/1e3,o=Math.round((u-S)/60);let h;if(o<2)return e!=null&&e.includeSeconds?u<5?r.formatDistance("lessThanXSeconds",5,c):u<10?r.formatDistance("lessThanXSeconds",10,c):u<20?r.formatDistance("lessThanXSeconds",20,c):u<40?r.formatDistance("halfAMinute",0,c):u<60?r.formatDistance("lessThanXMinutes",1,c):r.formatDistance("xMinutes",1,c):o===0?r.formatDistance("lessThanXMinutes",1,c):r.formatDistance("xMinutes",o,c);if(o<45)return r.formatDistance("xMinutes",o,c);if(o<90)return r.formatDistance("aboutXHours",1,c);if(o<w){const m=Math.round(o/60);return r.formatDistance("aboutXHours",m,c)}else{if(o<f)return r.formatDistance("xDays",1,c);if(o<N){const m=Math.round(o/w);return r.formatDistance("xDays",m,c)}else if(o<N*2)return h=Math.round(o/N),r.formatDistance("aboutXMonths",h,c)}if(h=G(i,t),h<12){const m=Math.round(o/N);return r.formatDistance("xMonths",m,c)}else{const m=h%12,y=Math.trunc(h/12);return m<3?r.formatDistance("aboutXYears",y,c):m<9?r.formatDistance("overXYears",y,c):r.formatDistance("almostXYears",y+1,c)}}function J(a,s){return q(a,H(a),s)}const K=()=>{const[a,s]=D.useState([]),[e,l]=D.useState(!0);D.useEffect(()=>{r();const t=setInterval(r,3e4);return()=>clearInterval(t)},[]);const r=async()=>{try{l(!0);const{data:t}=await M.get("/notifications/admin");s(t),l(!1)}catch(t){console.error("Failed to fetch notifications:",t),g.error("Failed to load notifications"),l(!1)}},f=async t=>{try{await M.put(`/notifications/${t}/read`),s(i=>i.map(u=>u._id===t?{...u,isRead:!0}:u))}catch(i){console.error("Failed to mark notification as read:",i),g.error("Failed to update notification")}},d=async()=>{try{await M.put("/notifications/mark-all-read"),s(t=>t.map(i=>({...i,isRead:!0}))),g.success("All notifications marked as read")}catch(t){console.error("Failed to mark all notifications as read:",t),g.error("Failed to update notifications")}},c=t=>{switch(t){case"attendance":return n.jsx(O,{className:"text-blue-500"});case"leave":return n.jsx(X,{className:"text-yellow-500"});case"message":return n.jsx(R,{className:"text-green-500"});case"profile":return n.jsx(E,{className:"text-purple-500"});case"document":return n.jsx(A,{className:"text-red-500"});default:return n.jsx(_,{className:"text-gray-500"})}};return e&&a.length===0?n.jsx("div",{className:"flex justify-center p-8",children:"Loading notifications..."}):n.jsxs("div",{className:"bg-white shadow rounded-lg",children:[n.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[n.jsx("h3",{className:"text-lg font-medium",children:"Activity Notifications"}),a.some(t=>!t.isRead)&&n.jsxs("button",{onClick:d,className:"text-sm text-indigo-600 hover:text-indigo-800 flex items-center",children:[n.jsx(k,{className:"mr-1"})," Mark all as read"]})]}),a.length===0?n.jsxs("div",{className:"p-8 text-center text-gray-500",children:[n.jsx(F,{className:"mx-auto text-4xl mb-4 text-gray-300"}),n.jsx("p",{children:"No notifications to display"})]}):n.jsx("div",{className:"divide-y divide-gray-100",children:a.map(t=>n.jsxs("div",{className:`p-4 flex items-start hover:bg-gray-50 transition-colors cursor-default ${t.isRead?"":"bg-blue-50"}`,children:[n.jsx("div",{className:"mr-4 mt-1",children:c(t.type)}),n.jsxs("div",{className:"flex-1",children:[t.employeeId?n.jsxs("div",{className:"flex items-center mb-1",children:[n.jsx("div",{className:"w-6 h-6 mr-2 overflow-hidden rounded-full",children:n.jsx("img",{src:t.employeeId.profileImage?C(t.employeeId.profileImage):b,alt:"Employee",className:"w-full h-full object-cover",onError:i=>{i.target.onerror=null,i.target.src=b}})}),n.jsxs("span",{className:"font-medium text-sm",children:[t.employeeId.firstName," ",t.employeeId.lastName]})]}):null,n.jsx("p",{className:"text-gray-800",children:t.message}),n.jsxs("div",{className:"mt-1 flex justify-between",children:[n.jsx("span",{className:"text-xs text-gray-500",children:J(new Date(t.createdAt),{addSuffix:!0})}),!t.isRead&&n.jsx("button",{onClick:()=>f(t._id),className:"text-xs text-indigo-600 hover:text-indigo-800",children:"Mark as read"})]})]})]},t._id))})]})},se=()=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx(F,{className:"mr-2 text-indigo-600 text-xl"}),n.jsx("h2",{className:"text-2xl font-semibold",children:"Notifications"})]}),n.jsx("p",{className:"text-gray-600",children:"View all employee activities and system notifications."}),n.jsx(K,{})]});export{se as default};
