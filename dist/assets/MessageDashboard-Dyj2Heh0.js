import{r as l,b as m,B as c,j as s}from"./index-CvOK6pca.js";import{C as j,D as A,j as P,a as k,g as D}from"./index-B8cdnCNl.js";import{M as L,a as T}from"./MessageForm-DL23UPW_.js";import{P as N}from"./constants-C-b4r1xk.js";import{g as U}from"./helpers-CaOlnEck.js";import"./format-BJRZ2Kak.js";import"./en-US-D8UQXs-H.js";const B=()=>{const[g,y]=l.useState([]),[v,t]=l.useState(!0),[o,d]=l.useState([]),[r,u]=l.useState(null),[n,h]=l.useState("inbox");l.useEffect(()=>{E(),f();const e=setInterval(f,3e4);return()=>clearInterval(e)},[]),l.useEffect(()=>{r&&I(r)},[r]);const E=async()=>{try{const{data:e}=await m.get("/messages/users");y(e)}catch(e){console.error("Failed to fetch employees:",e),c.error("Failed to load employees")}},f=async()=>{try{t(!0);const{data:e}=await m.get("/messages");d(e),t(!1)}catch(e){console.error("Failed to fetch messages:",e),t(!1),c.error("Failed to load messages")}},I=async e=>{if(!(!e||!e.userId))try{t(!0);const{data:a}=await m.get(`/messages/${e.userId}`);d(a),t(!1)}catch(a){console.error("Failed to fetch conversation:",a),t(!1),c.error("Failed to load conversation")}},w=async()=>{try{t(!0);const{data:e}=await m.get("/messages/public");d(e),t(!1)}catch(e){console.error("Failed to fetch public messages:",e),t(!1),c.error("Failed to load public messages")}},p=e=>{h(e),u(null),e==="public"?w():f()},F=e=>{const a=g.find(i=>i._id===e);a&&a.userId&&(h("private"),u({employeeId:e,userId:a.userId._id}))},M=async(e,a)=>{var i,b;try{let x={content:e,isPublic:a};if(!a&&!r){c.error("Please select an employee to message");return}a||(x.receiverId=r.userId);const{data:_}=await m.post("/messages",x);d([...o,_]),c.success("Message sent successfully")}catch(x){c.error(((b=(i=x.response)==null?void 0:i.data)==null?void 0:b.message)||"Failed to send message")}},S=e=>{if(!e||!e.employeeId)return"Employee";const a=g.find(i=>i._id===e.employeeId);return a?`${a.firstName} ${a.lastName}`:"Employee"},C=()=>n==="inbox"?o:n==="public"?o.filter(e=>e.isPublic):o,$=e=>{e.target.onerror=null,e.target.src=N};return v&&o.length===0?s.jsx("div",{className:"flex justify-center p-8",children:"Loading messages..."}):s.jsxs("div",{className:"flex h-[calc(100vh-13rem)]",children:[s.jsxs("div",{className:"w-72 bg-white shadow-md border-r",children:[s.jsx("div",{className:"p-4 border-b",children:s.jsx("h2",{className:"text-lg font-medium",children:"Messaging"})}),s.jsxs("div",{className:"p-3",children:[s.jsxs("div",{className:"mb-4 flex",children:[s.jsxs("button",{onClick:()=>p("inbox"),className:`flex items-center px-3 py-2 text-sm font-medium rounded-md mr-1 flex-1 ${n==="inbox"?"bg-indigo-100 text-indigo-800":"text-gray-700 hover:bg-gray-100"}`,children:[s.jsx(j,{className:"mr-2"})," Inbox"]}),s.jsxs("button",{onClick:()=>p("public"),className:`flex items-center px-3 py-2 text-sm font-medium rounded-md flex-1 ${n==="public"?"bg-indigo-100 text-indigo-800":"text-gray-700 hover:bg-gray-100"}`,children:[s.jsx(A,{className:"mr-2"})," Public"]})]}),s.jsx("div",{className:"mb-2 px-1",children:s.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Employees"})}),s.jsx("div",{className:"space-y-1 max-h-[calc(100vh-25rem)] overflow-y-auto",children:g.map(e=>s.jsxs("button",{onClick:()=>F(e._id),className:`flex items-center w-full px-3 py-2 text-sm font-medium rounded-md ${r===e._id?"bg-indigo-100 text-indigo-800":"text-gray-700 hover:bg-gray-100"}`,children:[s.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full overflow-hidden mr-3",children:s.jsx("img",{src:e.profileImage?U(e.profileImage):N,alt:`${e.firstName} ${e.lastName}`,className:"h-full w-full object-cover",onError:$})}),s.jsxs("div",{className:"text-left",children:[s.jsxs("div",{className:"font-medium",children:[e.firstName," ",e.lastName]}),s.jsx("div",{className:"text-xs text-gray-500",children:e.department})]})]},e._id))})]})]}),s.jsxs("div",{className:"flex-1 bg-white shadow-lg flex flex-col",children:[s.jsx("div",{className:"border-b p-4 bg-gray-50 flex items-center",children:r?s.jsxs("div",{className:"flex items-center",children:[s.jsx(P,{className:"text-gray-500 mr-2"}),s.jsx("span",{className:"font-medium",children:S(r)})]}):n==="public"?s.jsxs("div",{className:"flex items-center",children:[s.jsx(k,{className:"text-gray-500 mr-2"}),s.jsx("span",{className:"font-medium",children:"Public Announcements"})]}):s.jsxs("div",{className:"flex items-center",children:[s.jsx(j,{className:"text-gray-500 mr-2"}),s.jsx("span",{className:"font-medium",children:"All Messages"})]})}),s.jsx(L,{messages:C()}),s.jsx(T,{onSendMessage:M,enablePublicOption:n==="public"||!r})]})]})},K=()=>s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(D,{className:"mr-2 text-indigo-600 text-xl"}),s.jsx("h2",{className:"text-2xl font-semibold",children:"Message Dashboard"})]}),s.jsx("p",{className:"text-gray-600",children:"Send public announcements to all employees or message employees directly."}),s.jsx(B,{})]});export{K as default};
