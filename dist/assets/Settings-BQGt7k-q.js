import{r as n,b as x,B as d,j as e}from"./index-CvOK6pca.js";import{W as U,j as _,X as k,Y as D}from"./index-B8cdnCNl.js";const R=()=>{var b,w;const[o,j]=n.useState([]),[I,c]=n.useState(!0),[r,h]=n.useState(""),[a,m]=n.useState({username:"",password:""}),[u,f]=n.useState(!1),[g,v]=n.useState("");n.useEffect(()=>{S()},[]);const S=async()=>{try{c(!0);const{data:s}=await x.get("/admin/employees");j(s),c(!1)}catch{d.error("Failed to fetch employees"),c(!1)}},E=s=>{const l=s.target.value;h(l),m({username:"",password:""})},y=s=>{const{name:l,value:i}=s.target;m(t=>({...t,[l]:i}))},C=async s=>{var l,i;if(s.preventDefault(),!r){d.error("Please select an employee");return}if(!a.username&&!a.password){d.error("Please enter a new username or password");return}try{f(!0);const t={};a.username&&(t.username=a.username),a.password&&(t.password=a.password),await x.put(`/admin/user-credentials/${r}`,t),d.success("Credentials updated successfully");const N=o.find(p=>p._id===r),F=`Credentials updated for ${N.firstName} ${N.lastName} on ${new Date().toLocaleDateString()}. ${a.username?`New username: ${a.username}`:""} ${a.password?`New password: ${a.password}`:""}`;try{await x.post("/admin/employee-notes",{employeeId:r,note:F,type:"credential-update"})}catch(p){console.error("Failed to save credential note:",p)}m({username:"",password:""}),h("")}catch(t){d.error(((i=(l=t.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to update credentials")}finally{f(!1)}},$=o.filter(s=>`${s.firstName} ${s.lastName} ${s.email}`.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Account Recovery"}),e.jsx("p",{className:"text-gray-600",children:"Reset employee credentials when they've been forgotten"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("h2",{className:"text-lg font-semibold flex items-center",children:[e.jsx(U,{className:"mr-2 text-indigo-600"}),"Employee Credential Management"]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"search",className:"block mb-2 text-sm font-medium text-gray-700",children:"Search Employee"}),e.jsx("input",{type:"text",id:"search",value:g,onChange:s=>v(s.target.value),placeholder:"Search by name or email...",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"})]}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"employee",className:"block mb-2 text-sm font-medium text-gray-700",children:"Select Employee"}),e.jsxs("select",{id:"employee",value:r,onChange:E,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",children:[e.jsx("option",{value:"",children:"-- Select an employee --"}),$.map(s=>e.jsxs("option",{value:s._id,children:[s.firstName," ",s.lastName," - ",s.email]},s._id))]})]}),r&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h3",{className:"font-medium text-blue-800 mb-2",children:[(b=o.find(s=>s._id===r))==null?void 0:b.firstName," ",(w=o.find(s=>s._id===r))==null?void 0:w.lastName]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Enter new username and/or password for this employee"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"username",className:"block mb-2 text-sm font-medium text-gray-700",children:[e.jsx(_,{className:"inline mr-2"})," New Username"]}),e.jsx("input",{type:"text",id:"username",name:"username",value:a.username,onChange:y,placeholder:"Enter new username",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",disabled:!r})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"password",className:"block mb-2 text-sm font-medium text-gray-700",children:[e.jsx(k,{className:"inline mr-2"})," New Password"]}),e.jsx("input",{type:"text",id:"password",name:"password",value:a.password,onChange:y,placeholder:"Enter new password",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500",disabled:!r}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Password will be stored in plaintext in admin notes for future reference"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:u||!r||!a.username&&!a.password,className:`flex items-center px-6 py-2 rounded-md text-white font-medium
                  ${u||!r||!a.username&&!a.password?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:[e.jsx(D,{className:"mr-2"}),u?"Updating...":"Update Credentials"]})})]}),e.jsxs("div",{className:"mt-8 pt-8 border-t border-gray-200",children:[e.jsx("h3",{className:"text-md font-medium text-gray-700",children:"Important Notes"}),e.jsxs("ul",{className:"mt-2 list-disc list-inside text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"Only use this feature when an employee has forgotten their credentials"}),e.jsx("li",{children:"Updated credentials will be stored securely in admin notes for reference"}),e.jsx("li",{children:"Inform the employee of their new credentials via a secure channel"})]})]})]})]})]})};export{R as default};
