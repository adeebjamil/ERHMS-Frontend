import{u as x,r as d,j as e,b}from"./index-CvOK6pca.js";import{K as f,B as h,L as p}from"./index-B8cdnCNl.js";import{f as j}from"./format-BJRZ2Kak.js";const g=({message:s})=>{const{currentUser:o}=x(),[r,c]=d.useState(s.isRead),n=s.senderId&&typeof s.senderId=="object",t=n?s.senderId._id:s.senderId,l=n?s.senderId.username:"Unknown User",a=o&&t===o._id,i=s.isPublic,u=async()=>{if(!(a||r))try{await b.put(`/messages/${s._id}/read`),c(!0)}catch(m){console.error("Failed to mark message as read:",m)}};return e.jsxs("div",{className:`mb-4 p-4 rounded-lg ${a?"ml-auto bg-blue-100 text-blue-900":"mr-auto bg-gray-100 text-gray-900"} 
        ${i?"border-l-4 border-yellow-500":""}`,style:{maxWidth:"80%"},onClick:u,children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("p",{className:"text-xs font-bold",children:[a?"You":l,i&&e.jsx("span",{className:"ml-2 px-1 bg-yellow-200 text-yellow-800 rounded text-xs",children:"Public"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:j(new Date(s.createdAt),"MMM d, h:mm a")})]}),e.jsx("p",{className:"whitespace-pre-wrap",children:s.content}),a&&e.jsx("div",{className:"flex justify-end mt-1",children:r?e.jsx(f,{className:"text-blue-600 text-xs"}):e.jsx(h,{className:"text-gray-400 text-xs"})})]})},w=({messages:s})=>{const o=d.useRef(null);d.useEffect(()=>{r()},[s]);const r=()=>{var t;(t=o.current)==null||t.scrollIntoView({behavior:"smooth"})},c=s.reduce((t,l)=>{const a=`${l._id}_${l.createdAt}`;return t[a]||(t[a]=l),t},{}),n=Object.values(c);return e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[n.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"No messages yet"}):n.map((t,l)=>e.jsx(g,{message:t},`${t._id}_${l}`)),e.jsx("div",{ref:o})]})},M=({onSendMessage:s,enablePublicOption:o=!1})=>{const[r,c]=d.useState(""),[n,t]=d.useState(!1),l=a=>{a.preventDefault(),r.trim()&&(s(r,n),c(""))};return e.jsxs("form",{onSubmit:l,className:"border-t p-3",children:[o&&e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("input",{type:"checkbox",id:"public-message",checked:n,onChange:a=>t(a.target.checked),className:"mr-2"}),e.jsx("label",{htmlFor:"public-message",className:"text-sm font-medium",children:"Public message (visible to all employees)"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("textarea",{value:r,onChange:a=>c(a.target.value),placeholder:"Type your message here...",className:"flex-1 border rounded-l-lg p-2 resize-none focus:outline-none focus:ring focus:border-blue-300",rows:2}),e.jsx("button",{type:"submit",disabled:!r.trim(),className:"bg-blue-600 text-white px-4 rounded-r-lg disabled:bg-blue-300",children:e.jsx(p,{})})]})]})};export{w as M,M as a};
